<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CivicServe</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Mulish Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Mulish:ital,wght@0,200..1000;1,200..1000&display=swap" rel="stylesheet">
    <style>
        :root {
            --c-primary: 0, 55, 96; /* Blue color in RGB matching header #003760 */
            --c-landing-primary: 0, 55, 96;
            --c-landing-light20-primary-color: #1a4a7a;
            --c-landing-light30-primary-color: #2d5d8d;
            --c-landing-light35-primary-color: #3a6a9a;
            --c-landing-light40-primary-color: #4777a7;
            --c-landing-darken10-primary-color: #002040;
            --c-landing-secondary: #ffa800;
            --c-primary-contrast: #003760;
            --c-font-primary: #333333;
            --c-font-secondary: #6b7280;
            --c-card-background: #ffffff;
            --c-background: #f8f9fa;
            --c-success: #9CB1C1;
            --c-danger: #F44336;
            --c-warning: #f0ad4e;
            --dim-header-height: 60px;
        }
        
        /* General Body Styles for the overall page */
        body {
            font-family: 'Mulish', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--c-font-primary);
            background-color: var(--c-background);
            margin: 0;
            padding: 0;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            min-height: 100vh;
        }
        
        h2, h3, h4, h5, h6 {
            font-family: 'Mulish', sans-serif;
            font-weight: normal;
            margin-bottom: 1.5rem;
        }

        /* Styles for the Email Section */
        #email-section {
            max-width: 600px;
            margin: 40px auto;
            background-color: var(--c-card-background);
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        #email-section h2 {
            color: var(--c-font-primary);
            margin-top: 0;
            font-family: 'Mulish', sans-serif;
        }
        #email-section ul {
            list-style: none;
            padding: 0;
            margin-bottom: 20px;
        }
        #email-section ul li {
            margin-bottom: 10px;
            padding-left: 20px;
            position: relative;
        }
        #email-section ul li::before {
            content: 'â€¢';
            color: rgb(var(--c-primary));
            font-size: 1.2em;
            position: absolute;
            left: 0;
            top: 0;
        }
        #email-section strong {
            font-weight: 600;
        }
        #email-section .important-note {
            background-color: var(--c-background);
            padding: 15px;
            border-left: 5px solid rgb(var(--c-primary));
            margin-bottom: 20px;
            border-radius: 4px;
        }
        #email-section .button {
            display: inline-block;
            background-color: rgb(var(--c-primary));
            color: #ffffff !important;
            padding: 12px 25px;
            text-align: center;
            text-decoration: none;
            border-radius: 4px;
            font-weight: 500;
            margin-top: 20px;
            transition: all 0.15s ease-in-out;
        }
        #email-section .button:hover {
            background-color: var(--c-landing-light20-primary-color);
            text-decoration: none;
            color: #ffffff !important;
        }
        #email-section .footer {
            margin-top: 30px;
            font-size: .875rem;
            color: var(--c-font-secondary);
            border-top: 1px solid #e5e7eb;
            padding-top: 20px;
        }

        /* Styles for the Command Center Section */
        #command-center-section {
            background-color: var(--c-background);
            padding: 20px;
            min-height: 100vh;
        }
        
        .command-center-container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: var(--c-card-background);
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            position: relative;
        }
        
        .command-center-title {
            font-size: 2rem;
            font-weight: 600;
            color: var(--c-font-primary);
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        .command-center-subtitle {
            color: var(--c-font-secondary);
            text-align: center;
            margin-bottom: 2rem;
        }

        /* Common styles for both sections or interactive elements */
        .hidden-section {
            display: none;
        }
        
        .modal {
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            opacity: 0;
            transform: scale(0.95);
            visibility: hidden;
        }
        
        .modal.open {
            opacity: 1;
            transform: scale(1);
            visibility: visible;
        }
        
        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        
        .collapsible-content.expanded {
            max-height: 1000px;
            transition: max-height 0.5s ease-in;
        }
        
        .arrow-icon {
            transition: transform 0.3s ease;
        }
        
        .arrow-icon.rotated {
            transform: rotate(180deg);
        }
        
        .dropdown-menu {
            opacity: 0;
            transform: translateY(-10px);
            visibility: hidden;
            transition: opacity 0.2s ease-out, transform 0.2s ease-out;
        }
        
        .dropdown-menu.show {
            opacity: 1;
            transform: translateY(0);
            visibility: visible;
        }
        
        .inline-custom-input {
            width: 100%;
            padding: 0.5rem 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            outline: none;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--c-font-primary);
            transition: all 0.15s ease-in-out;
        }
        
        .inline-custom-input:focus {
            border-color: rgb(var(--c-primary));
            box-shadow: 0 0 0 2px rgba(var(--c-primary), 0.2);
        }
        
        /* Button styling to match CivicServe design */
        .btn-primary {
            background-color: rgb(var(--c-primary));
            border-color: rgb(var(--c-primary));
            color: white;
            font-weight: 500;
            border-radius: 4px;
            transition: all 0.15s ease-in-out;
        }
        
        .btn-primary:hover {
            background-color: var(--c-landing-light20-primary-color);
            border-color: var(--c-landing-light20-primary-color);
            color: white;
        }
        
        .btn-secondary {
            background-color: #6c757d;
            border-color: #6c757d;
            color: white;
            font-weight: 500;
            border-radius: 4px;
            transition: all 0.15s ease-in-out;
        }
        
        .btn-secondary:hover {
            background-color: #5a6268;
            border-color: #545b62;
            color: white;
        }
        
        /* Summary cards styling */
        .summary-card {
            background-color: #e3f2fd;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .summary-card-label {
            font-size: 0.875rem;
            color: var(--c-primary-contrast);
            font-weight: 500;
            margin-bottom: 0.5rem;
        }
        
        .summary-card-value {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--c-primary-contrast);
        }
        
        /* Record card styling */
        .record-card {
            background-color: var(--c-card-background);
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
            overflow: hidden;
            margin-bottom: 1rem;
        }
        
        .record-header {
            background-color: #e3f2fd;
            padding: 1.5rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        
        .record-header:hover {
            background-color: #bbdefb;
        }
        
        .record-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--c-primary-contrast);
            margin-bottom: 0.5rem;
        }
        
        .record-meta {
            font-size: 0.875rem;
            color: var(--c-primary-contrast);
            margin-bottom: 0.5rem;
        }
        
        .record-fields {
            font-size: 0.875rem;
            color: var(--c-primary-contrast);
        }
        
        /* Field row styling */
        .field-row {
            padding: 0.75rem;
            background-color: var(--c-card-background);
            border-radius: 4px;
            border: 1px solid #f3f4f6;
            margin-bottom: 0.5rem;
        }
        
        .field-label {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--c-font-primary);
        }
        
        .field-value {
            font-size: 0.875rem;
            color: var(--c-font-secondary);
        }
        
        .field-value.bold, .inline-custom-input.bold {
            font-weight: 600;
            color: var(--c-font-primary);
        }
        
        .user-entered-label {
            color: var(--c-danger);
            font-size: .875rem;
            margin-left: 0.25rem;
        }
    </style>
</head>
<body>

    <!-- Email Section -->
    <div id="email-section">
        <h2>Subject: Important Update: Your Business Contacts Have Been Refreshed!</h2>

        <p>Hi Progress Village,</p>

        <p>We wanted to let you know that your business contact data has recently been updated in your CRM. These updates help ensure you have the most accurate and current information for your contacts.</p>

        <p>Here's a quick summary of the recent changes:</p>
        <ul>
            <li><strong>Date of Update:</strong> August 15, 2025</li>
            <li><strong>Source of Updates:</strong> Google, Yelp, DatabaseUSA</li>
            <li><strong>Records Updated:</strong> 125</li>
            <li><strong>Impact:</strong> 5% of your total contacts have received updates.</li>
        </ul>

        <div class="important-note">
            <p><strong>Please note:</strong> Any data you've personally entered or customized will <strong>never</strong> be overwritten by our system updates. We're focused on updating the default values for businesses in our database, making sure you always have the latest and greatest intelligence available.</p>
        </div>
        <div class="footer">
            <p>If you have any questions or need assistance, please don't hesitate to contact our support team.</p>
            <p>Best regards,</p>
            <p>The CivicServe Team</p>
        </div>
    </div>

    <!-- Command Center Section (Initially hidden) -->
    <div id="command-center-section" class="hidden-section">
        <div class="command-center-container">
            <h1 class="command-center-title">
                Business Contact Update Command Center
            </h1>
            <p class="command-center-subtitle">
                Review and manage recent updates to your business contacts.
            </p>

            <!-- Manage Updates Button with Dropdown -->
            <div class="position-absolute top-0 end-0 mt-3 me-3">
                <button class="btn btn-secondary btn-sm dropdown-toggle"
                        onclick="toggleDropdown('manage-updates-dropdown')">
                    Manage Updates
                </button>
                <div id="manage-updates-dropdown" class="dropdown-menu position-absolute end-0 mt-2" style="min-width: 200px;">
                    <a href="javascript:void(0);" class="dropdown-item" onclick="undoAllCurrentUpdates();">Un-do all updates</a>
                    <a href="javascript:void(0);" class="dropdown-item" onclick="rejectAllFutureUpdates();">Reject all future updates</a>
                </div>
            </div>

            <!-- Summary Section -->
            <div class="row g-3 mb-5 mt-5">
                <div class="col-md-4">
                    <div class="summary-card">
                        <div class="summary-card-label">Last Update On</div>
                        <div class="summary-card-value" id="summary-date">August 15, 2025</div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="summary-card">
                        <div class="summary-card-label">Contacts Updated</div>
                        <div class="summary-card-value" id="summary-records">125 (5%)</div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="summary-card">
                        <div class="summary-card-label">Update Source</div>
                        <div class="summary-card-value" id="summary-source">Google, Yelp</div>
                    </div>
                </div>
            </div>

            <!-- Message Box -->
            <div id="message-box" class="modal fade" tabindex="-1">
                <div class="modal-dialog modal-sm modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-body text-center p-4">
                            <p id="message-text" class="fs-5 fw-semibold mb-3"></p>
                            <button class="btn btn-primary" onclick="closeMessageBox()">
                                OK
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Updated Records List -->
            <h2 class="fs-3 fw-semibold mb-4 pb-3 border-bottom">Details of Changes</h2>
            <div id="records-container">
                <!-- Records will be dynamically loaded here -->
            </div>
        </div>
    </div>

    <script>
        // Mock Data for demonstration
        const mockUpdates = [
            {
                id: 'contact-1',
                businessName: 'Acme Innovations Inc.',
                source: 'Google',
                lastUpdateDate: 'August 15, 2025',
                changes: [
                    { field: 'Business Name', oldValue: 'Acme Innovations', newValue: 'Acme Innovations Inc.', isUserEntered: false },
                    { field: 'Physical Address', oldValue: '123 Main St', newValue: '123 Main St, Suite 100', isUserEntered: false },
                    { field: 'Hours of Operation', oldValue: '9-5 M-F', newValue: '8-6 M-F', isUserEntered: false }
                ]
            },
            {
                id: 'contact-2',
                businessName: 'Globex Corporation',
                source: 'Yelp',
                lastUpdateDate: 'August 10, 2025',
                changes: [
                    { field: 'Number of Employees', oldValue: '500', newValue: '550', isUserEntered: false },
                    { field: 'Total Revenue', oldValue: '$100M', newValue: '$110M', isUserEntered: true } // User-entered field
                ]
            },
            {
                id: 'contact-3',
                businessName: 'Pied Piper Inc.',
                source: 'DatabaseUSA',
                lastUpdateDate: 'July 28, 2025',
                changes: [
                    { field: 'Business Name', oldValue: 'Pied Piper', newValue: 'Pied Piper Inc.', isUserEntered: false },
                    { field: 'Physical Address', oldValue: '1 Silicon Way', newValue: '1 Silicon Way, Palo Alto', isUserEntered: true } // User-entered field
                ]
            },
            {
                id: 'contact-4',
                businessName: 'Initech Solutions',
                source: 'Google',
                lastUpdateDate: 'August 14, 2025',
                changes: [
                    { field: 'Business Name', oldValue: 'Initech', newValue: 'Initech Solutions', isUserEntered: false },
                    { field: 'Phone Number', oldValue: '555-1234', newValue: '555-9876', isUserEntered: false }
                ]
            },
            {
                id: 'contact-5',
                businessName: 'Bluth Company',
                source: 'Yelp',
                lastUpdateDate: 'August 05, 2025',
                changes: [
                    { field: 'Total Revenue', oldValue: '$5M', newValue: '$6.2M', isUserEntered: false },
                    { field: 'Website', oldValue: 'bluth.com', newValue: 'bluthco.com', isUserEntered: false }
                ]
            },
            {
                id: 'contact-6',
                businessName: 'Vandelay Industries',
                source: 'DatabaseUSA',
                lastUpdateDate: 'July 20, 2025',
                changes: [
                    { field: 'Physical Address', oldValue: '129 W 81st St', newValue: '130 W 81st St, Suite 2B', isUserEntered: true }, // User-entered
                    { field: 'Number of Employees', oldValue: '10', newValue: '12', isUserEntered: false }
                ]
            }
        ];

        /**
         * Toggles the visibility of a dropdown menu.
         * @param {string} dropdownId - The ID of the dropdown element.
         */
        function toggleDropdown(dropdownId) {
            const dropdown = document.getElementById(dropdownId);
            dropdown.classList.toggle('show');
        }

        // Close dropdown when clicking outside
        window.onclick = function(event) {
            // Check if the click is outside any dropdown button AND not inside an open dropdown menu
            if (!event.target.matches('.bg-gray-800') && !event.target.closest('.dropdown-menu')) {
                const dropdowns = document.getElementsByClassName('dropdown-menu');
                for (let i = 0; i < dropdowns.length; i++) {
                    const openDropdown = dropdowns[i];
                    if (openDropdown.classList.contains('show')) {
                        openDropdown.classList.remove('show');
                    }
                }
            }
        }

        /**
         * Displays a message box with the given text.
         * @param {string} message - The message to display.
         */
        function openMessageBox(message) {
            document.getElementById('message-text').textContent = message;
            const modal = new bootstrap.Modal(document.getElementById('message-box'));
            modal.show();
        }

        /**
         * Closes the currently open message box.
         */
        function closeMessageBox() {
            const modal = bootstrap.Modal.getInstance(document.getElementById('message-box'));
            if (modal) {
                modal.hide();
            }
        }

        /**
         * Toggles the expansion state of a record card.
         * @param {string} recordId - The ID of the record to toggle.
         */
        function toggleRecord(recordId) {
            const content = document.getElementById(`collapsible-${recordId}`);
            const arrow = document.getElementById(`arrow-${recordId}`);
            if (content.classList.contains('expanded')) {
                content.classList.remove('expanded');
                content.style.maxHeight = '0';
                arrow.classList.remove('rotated');
            } else {
                content.classList.add('expanded');
                content.style.maxHeight = content.scrollHeight + 'px'; // Set to scrollHeight to allow dynamic content
                arrow.classList.add('rotated');
            }
        }

        /**
         * Handles the change event for a field's radio button, updating display and inline input visibility.
         * @param {string} recordId - The ID of the record.
         * @param {string} fieldName - The name of the field.
         * @param {string} selection - The selected option ('new', 'old', 'custom').
         * @param {string} fieldUniqueId - The unique ID for the field's elements.
         * @param {string} originalOldValue - The original old value of the field.
         * @param {string} originalNewValue - The original new value suggested by the system.
         * @param {boolean} isUserEntered - True if the field was user-entered, false otherwise.
         */
        function handleRadioChange(recordId, fieldName, selection, fieldUniqueId, originalOldValue, originalNewValue, isUserEntered) {
            const oldValueSpan = document.getElementById(`old-value-display-${fieldUniqueId}`);
            const newValueSpan = document.getElementById(`new-value-display-${fieldUniqueId}`);
            const inlineInput = document.getElementById(`inline-custom-input-${fieldUniqueId}`);

            // Reset bolding and visibility for all options first
            oldValueSpan.classList.remove('bold');
            newValueSpan.classList.remove('bold');
            newValueSpan.classList.remove('d-none'); // Ensure new value display is visible by default for value setting
            inlineInput.classList.add('d-none'); // Hide custom input by default

            // Update the internal mock data's currentSelection
            const record = mockUpdates.find(r => r.id === recordId);
            const change = record.changes.find(c => c.field === fieldName);
            if (change) {
                change.currentSelection = selection;
            }

            if (selection === 'new') {
                newValueSpan.classList.add('bold');
                newValueSpan.textContent = originalNewValue;
            } else if (selection === 'old') {
                oldValueSpan.classList.add('bold');
                // For the "Updated:" column, we still display the system's 'newValue', but not bolded
                // unless it was a user-entered field, in which case the old value is the 'kept' value.
                newValueSpan.textContent = originalNewValue;
            } else if (selection === 'custom') {
                newValueSpan.classList.add('d-none'); // Hide the new value span
                inlineInput.classList.remove('d-none'); // Show the input field
                inlineInput.focus();
                // If there's a stored custom value, populate it
                inlineInput.value = change.customValue || '';
                inlineInput.classList.add('bold'); // Bold the input content directly
            }
        }

        /**
         * Reverts all changes in the current batch for all displayed businesses.
         * For mock, this sets all fields back to their 'old' value and updates UI.
         */
        function undoAllCurrentUpdates() {
            openMessageBox('All changes for this update batch have been undone.');
            console.log('Un-do all updates (current batch) clicked.');

            mockUpdates.forEach(record => {
                record.changes.forEach(change => {
                    const fieldUniqueId = `${record.id}-${change.field.replace(/\s/g, '-')}`;
                    
                    // Force currentSelection to 'old' for undo all
                    change.currentSelection = 'old';

                    const radioOld = document.getElementById(`radio-${fieldUniqueId}-old`);
                    if (radioOld) {
                        radioOld.checked = true;
                        // Manually call handleRadioChange to update UI and set bolding
                        handleRadioChange(
                            record.id,
                            change.field,
                            'old', // Force selection to 'old'
                            fieldUniqueId,
                            change.oldValue,
                            change.newValue,
                            change.isUserEntered
                        );
                    }
                });
            });
            toggleDropdown('manage-updates-dropdown'); // Close dropdown
        }

        /**
         * Sets a preference to reject all future automatic updates.
         */
        function rejectAllFutureUpdates() {
            openMessageBox('Your preference to reject all future automatic updates has been saved.');
            console.log('Reject all future updates clicked.');
            toggleDropdown('manage-updates-dropdown'); // Close dropdown
        }

        /**
         * Saves all selected changes for a specific record based on radio button choices.
         * @param {string} recordId - The ID of the record to save changes for.
         */
        function saveRecordChanges(recordId) {
            const record = mockUpdates.find(r => r.id === recordId);
            if (!record) {
                openMessageBox('Error: Record not found for saving changes.');
                return;
            }

            console.log(`Saving changes for record: ${record.businessName} (${record.id})`);
            record.changes.forEach(change => {
                const fieldUniqueId = `${record.id}-${change.field.replace(/\s/g, '-')}`;
                let finalValue = '';

                if (change.currentSelection === 'new') {
                    finalValue = change.newValue;
                    console.log(`Field: ${change.field}, Action: Keep New Value, Value: ${finalValue}`);
                } else if (change.currentSelection === 'old') {
                    finalValue = change.oldValue;
                    console.log(`Field: ${change.field}, Action: Revert to Old Value, Value: ${finalValue}`);
                } else if (change.currentSelection === 'custom') {
                    // Get value from inline input
                    const inlineInput = document.getElementById(`inline-custom-input-${fieldUniqueId}`);
                    finalValue = inlineInput ? inlineInput.value.trim() : (change.customValue || '');
                    change.customValue = finalValue; // Update stored custom value
                    console.log(`Field: ${change.field}, Action: Custom Value, Value: ${finalValue}`);
                }
                // Here you would send this 'finalValue' for 'change.field' for 'record.id' to your backend
            });
            openMessageBox(`Changes for ${record.businessName} have been saved!`);
        }

        /**
         * Shows the Command Center section and hides the Email section.
         * Also initializes the Command Center's records.
         */
        function showCommandCenter() {
            document.getElementById('email-section').classList.add('hidden-section');
            document.getElementById('command-center-section').classList.remove('hidden-section');
            loadRecords(); // Load records only when command center is shown
        }

        /**
         * Populates the records container with mock data.
         */
        function loadRecords() {
            const container = document.getElementById('records-container');
            container.innerHTML = ''; // Clear previous content

            mockUpdates.forEach(record => {
                const recordDiv = document.createElement('div');
                recordDiv.id = `record-${record.id}`;
                recordDiv.className = 'record-card';

                const updatedFieldsCount = record.changes.length;
                const updatedFieldNames = record.changes.map(change => change.field).join(', ');

                const generateFieldId = (fieldName) => `${record.id}-${fieldName.replace(/\s/g, '-')}`;

                recordDiv.innerHTML = `
                    <!-- Collapsible Header -->
                    <div class="record-header d-flex justify-content-between align-items-center"
                         onclick="toggleRecord('${record.id}')">
                        <div class="d-flex flex-column">
                            <h3 class="record-title">${record.businessName}</h3>
                            <div class="record-meta d-flex align-items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="me-2" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10v11h18V10M3 10l9-7 9 7M3 10h18" />
                                </svg>
                                Source: <span class="fw-medium ms-1">${record.source}</span>
                                <span class="ms-3">Update Date: <span class="fw-medium">${record.lastUpdateDate}</span></span>
                            </div>
                            <p class="record-fields mt-2 mb-0">
                                <span class="fw-semibold">${updatedFieldsCount} field${updatedFieldsCount !== 1 ? 's' : ''} updated:</span> ${updatedFieldNames}
                            </p>
                        </div>
                        <svg id="arrow-${record.id}" xmlns="http://www.w3.org/2000/svg" class="arrow-icon ms-3" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                    </div>

                    <!-- Collapsible Content -->
                    <div id="collapsible-${record.id}" class="collapsible-content">
                        <div class="p-4">
                            ${record.changes.map(change => {
                                const fieldUniqueId = generateFieldId(change.field);
                                // Determine initial checked state based on isUserEntered or explicit currentSelection
                                const defaultSelection = change.isUserEntered ? 'old' : 'new';
                                // Initialize change.currentSelection if not already set
                                if (!change.currentSelection) {
                                    change.currentSelection = defaultSelection;
                                }

                                return `
                                <div class="field-row row g-2 align-items-center mb-3">
                                    <div class="col-md-2">
                                        <div class="field-label">${change.field}</div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="field-value">
                                            <span class="fw-medium">Old:</span> 
                                            <span id="old-value-display-${fieldUniqueId}" class="${change.currentSelection === 'old' ? 'bold' : ''}">
                                                ${change.oldValue}
                                            </span>
                                            ${change.isUserEntered ? '<span class="user-entered-label">(User Entered)</span>' : ''}
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="field-value">
                                            <span class="fw-medium">Updated:</span> 
                                            <span id="new-value-display-${fieldUniqueId}" class="${change.currentSelection === 'custom' ? 'd-none' : (change.currentSelection === 'new' ? 'bold' : '')}">
                                                ${change.newValue}
                                            </span>
                                            <input type="text" id="inline-custom-input-${fieldUniqueId}" 
                                                class="inline-custom-input ${change.currentSelection !== 'custom' ? 'd-none' : ''}" 
                                                value="${change.customValue || ''}" placeholder="Enter custom value">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="d-flex flex-wrap gap-2 justify-content-end">
                                            <div class="form-check form-check-inline">
                                                <input type="radio" class="form-check-input" name="action-${fieldUniqueId}" id="radio-${fieldUniqueId}-new" value="new"
                                                    ${change.currentSelection === 'new' ? 'checked' : ''}
                                                    onchange="handleRadioChange('${record.id}', '${change.field}', 'new', '${fieldUniqueId}', '${change.oldValue}', '${change.newValue}', ${change.isUserEntered})">
                                                <label class="form-check-label small" for="radio-${fieldUniqueId}-new">Keep New</label>
                                            </div>
                                            <div class="form-check form-check-inline">
                                                <input type="radio" class="form-check-input" name="action-${fieldUniqueId}" id="radio-${fieldUniqueId}-old" value="old"
                                                    ${change.currentSelection === 'old' ? 'checked' : ''}
                                                    onchange="handleRadioChange('${record.id}', '${change.field}', 'old', '${fieldUniqueId}', '${change.oldValue}', '${change.newValue}', ${change.isUserEntered})">
                                                <label class="form-check-label small" for="radio-${fieldUniqueId}-old">Revert</label>
                                            </div>
                                            <div class="form-check form-check-inline">
                                                <input type="radio" class="form-check-input" name="action-${fieldUniqueId}" id="radio-${fieldUniqueId}-custom" value="custom"
                                                    ${change.currentSelection === 'custom' ? 'checked' : ''}
                                                    onchange="handleRadioChange('${record.id}', '${change.field}', 'custom', '${fieldUniqueId}', '${change.oldValue}', '${change.newValue}', ${change.isUserEntered})">
                                                <label class="form-check-label small" for="radio-${fieldUniqueId}-custom">Custom</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `;
                            }).join('')}
                            <div class="d-flex justify-content-end mt-4">
                                <button class="btn btn-secondary"
                                        onclick="saveRecordChanges('${record.id}')">
                                    Save Changes for This Record
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(recordDiv);
            });
        }

        // Initialize the page on load: email is visible, command center is hidden
        document.addEventListener('DOMContentLoaded', function() {
            // No initial loadRecords call here, as showCommandCenter will handle it.
        });
    </script>
    
    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
